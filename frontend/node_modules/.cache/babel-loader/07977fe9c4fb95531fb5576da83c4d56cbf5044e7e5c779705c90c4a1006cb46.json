{"ast":null,"code":"var _jsxFileName = \"D:\\\\Baitap\\\\Web2\\\\Endgame_Project\\\\frontend\\\\src\\\\context\\\\OrderContext.jsx\",\n  _s2 = $RefreshSig$(),\n  _s3 = $RefreshSig$();\n// src/context/OrderContext.jsx\nimport { createContext, useContext, useState } from 'react';\nimport { orderAPI } from '../services/api';\nimport { useNavigate } from 'react-router-dom';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst OrderContext = /*#__PURE__*/createContext();\nexport function OrderProvider({\n  children\n}) {\n  _s2();\n  var _s = $RefreshSig$();\n  const [selectedTable, setSelectedTable] = useState(null);\n  const [orderItems, setOrderItems] = useState([]);\n  const navigate = useNavigate();\n  const addItem = product => {\n    setOrderItems(prev => {\n      const existing = prev.find(i => i.id === product.id);\n      if (existing) {\n        return prev.map(i => i.id === product.id ? {\n          ...i,\n          qty: i.qty + 1\n        } : i);\n      }\n      return [...prev, {\n        ...product,\n        qty: 1\n      }];\n    });\n  };\n  const removeItem = id => {\n    setOrderItems(prev => prev.filter(i => i.id !== id));\n  };\n  const createOrder = async () => {\n    _s();\n    if (!selectedTable || orderItems.length === 0) return;\n    const {\n      user\n    } = useAuth(); // LẤY USER TỪ AUTH CONTEXT\n\n    const orderData = {\n      user: {\n        id: user.id || user.username\n      },\n      // GỬI user.id HOẶC username\n      table: {\n        id: selectedTable.id\n      },\n      items: orderItems.map(item => ({\n        productId: item.id,\n        productName: item.name,\n        quantity: item.qty,\n        price: item.price\n      })),\n      totalPrice: orderItems.reduce((sum, i) => sum + i.price * i.qty, 0)\n    };\n    try {\n      await orderAPI.create(orderData);\n      alert('Đặt món thành công!');\n      setOrderItems([]);\n      setSelectedTable(null);\n      navigate('/order-success');\n    } catch (err) {\n      var _err$response, _err$response$data;\n      console.error(err);\n      alert('Lỗi đặt món: ' + (((_err$response = err.response) === null || _err$response === void 0 ? void 0 : (_err$response$data = _err$response.data) === null || _err$response$data === void 0 ? void 0 : _err$response$data.message) || err.message));\n    }\n  };\n  _s(createOrder, \"9ep4vdl3mBfipxjmc+tQCDhw6Ik=\", true);\n  return /*#__PURE__*/_jsxDEV(OrderContext.Provider, {\n    value: {\n      selectedTable,\n      setSelectedTable,\n      orderItems,\n      addItem,\n      removeItem,\n      createOrder\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 57,\n    columnNumber: 5\n  }, this);\n}\n_s2(OrderProvider, \"c84g3r/E+h0zfo4HXi2GWZdhduE=\", false, function () {\n  return [useNavigate];\n});\n_c = OrderProvider;\nexport const useOrder = () => {\n  _s3();\n  return useContext(OrderContext);\n};\n_s3(useOrder, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\nvar _c;\n$RefreshReg$(_c, \"OrderProvider\");","map":{"version":3,"names":["createContext","useContext","useState","orderAPI","useNavigate","jsxDEV","_jsxDEV","OrderContext","OrderProvider","children","_s2","_s","$RefreshSig$","selectedTable","setSelectedTable","orderItems","setOrderItems","navigate","addItem","product","prev","existing","find","i","id","map","qty","removeItem","filter","createOrder","length","user","useAuth","orderData","username","table","items","item","productId","productName","name","quantity","price","totalPrice","reduce","sum","create","alert","err","_err$response","_err$response$data","console","error","response","data","message","Provider","value","fileName","_jsxFileName","lineNumber","columnNumber","_c","useOrder","_s3","$RefreshReg$"],"sources":["D:/Baitap/Web2/Endgame_Project/frontend/src/context/OrderContext.jsx"],"sourcesContent":["// src/context/OrderContext.jsx\r\nimport { createContext, useContext, useState } from 'react';\r\nimport { orderAPI } from '../services/api';\r\nimport { useNavigate } from 'react-router-dom';\r\n\r\nconst OrderContext = createContext();\r\n\r\nexport function OrderProvider({ children }) {\r\n  const [selectedTable, setSelectedTable] = useState(null);\r\n  const [orderItems, setOrderItems] = useState([]);\r\n  const navigate = useNavigate();\r\n\r\n  const addItem = (product) => {\r\n    setOrderItems(prev => {\r\n      const existing = prev.find(i => i.id === product.id);\r\n      if (existing) {\r\n        return prev.map(i => i.id === product.id ? { ...i, qty: i.qty + 1 } : i);\r\n      }\r\n      return [...prev, { ...product, qty: 1 }];\r\n    });\r\n  };\r\n\r\n  const removeItem = (id) => {\r\n    setOrderItems(prev => prev.filter(i => i.id !== id));\r\n  };\r\n\r\n  const createOrder = async () => {\r\n  if (!selectedTable || orderItems.length === 0) return;\r\n\r\n  const { user } = useAuth(); // LẤY USER TỪ AUTH CONTEXT\r\n\r\n  const orderData = {\r\n    user: { id: user.id || user.username }, // GỬI user.id HOẶC username\r\n    table: { id: selectedTable.id },\r\n    items: orderItems.map(item => ({\r\n      productId: item.id,\r\n      productName: item.name,\r\n      quantity: item.qty,\r\n      price: item.price\r\n    })),\r\n    totalPrice: orderItems.reduce((sum, i) => sum + i.price * i.qty, 0)\r\n  };\r\n\r\n  try {\r\n    await orderAPI.create(orderData);\r\n    alert('Đặt món thành công!');\r\n    setOrderItems([]);\r\n    setSelectedTable(null);\r\n    navigate('/order-success');\r\n  } catch (err) {\r\n    console.error(err);\r\n    alert('Lỗi đặt món: ' + (err.response?.data?.message || err.message));\r\n  }\r\n};\r\n\r\n  return (\r\n    <OrderContext.Provider value={{\r\n      selectedTable, setSelectedTable,\r\n      orderItems, addItem, removeItem, createOrder\r\n    }}>\r\n      {children}\r\n    </OrderContext.Provider>\r\n  );\r\n}\r\n\r\nexport const useOrder = () => useContext(OrderContext);"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}