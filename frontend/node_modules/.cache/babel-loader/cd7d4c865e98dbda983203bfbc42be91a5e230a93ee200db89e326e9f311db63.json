{"ast":null,"code":"var _jsxFileName = \"D:\\\\Baitap\\\\Web2\\\\Endgame_Project\\\\frontend\\\\src\\\\context\\\\OrderContext.jsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport { createContext, useContext, useState } from 'react';\nimport { orderAPI } from '../services/api';\nimport { useNavigate } from 'react-router-dom';\nimport { useAuth } from './AuthContext'; // ← ĐÚNG ĐẶNG\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst OrderContext = /*#__PURE__*/createContext();\nexport function OrderProvider({\n  children\n}) {\n  _s();\n  const [selectedTable, setSelectedTable] = useState(null);\n  const [orderItems, setOrderItems] = useState([]);\n  const navigate = useNavigate();\n  const {\n    user\n  } = useAuth(); // ← GỌI useAuth Ở CẤP CAO NHẤT → HỢP LỆ\n\n  const addItem = product => {\n    setOrderItems(prev => {\n      const existing = prev.find(i => i.id === product.id);\n      if (existing) {\n        return prev.map(i => i.id === product.id ? {\n          ...i,\n          qty: i.qty + 1\n        } : i);\n      }\n      return [...prev, {\n        ...product,\n        qty: 1\n      }];\n    });\n  };\n  const removeItem = id => {\n    setOrderItems(prev => prev.filter(i => i.id !== id));\n  };\n  const createOrder = async () => {\n    if (!selectedTable || orderItems.length === 0) return;\n    if (!(user !== null && user !== void 0 && user.id)) {\n      alert('Không tìm thấy thông tin người dùng! Vui lòng đăng nhập lại.');\n      navigate('/login');\n      return;\n    }\n    const orderData = {\n      user: {\n        id: user.id\n      },\n      // ← GỬI user.id\n      table: {\n        id: selectedTable.id\n      },\n      items: orderItems.map(item => ({\n        productId: item.id,\n        productName: item.name,\n        quantity: item.qty,\n        price: item.price\n      })),\n      totalPrice: orderItems.reduce((sum, i) => sum + i.price * i.qty, 0)\n    };\n    try {\n      await orderAPI.create(orderData);\n      alert('Đặt món thành công!');\n      setOrderItems([]);\n      setSelectedTable(null);\n      navigate('/order-success');\n    } catch (err) {\n      var _err$response, _err$response$data;\n      console.error(err);\n      alert('Lỗi: ' + (((_err$response = err.response) === null || _err$response === void 0 ? void 0 : (_err$response$data = _err$response.data) === null || _err$response$data === void 0 ? void 0 : _err$response$data.message) || 'Không thể đặt món'));\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(OrderContext.Provider, {\n    value: {\n      selectedTable,\n      setSelectedTable,\n      orderItems,\n      addItem,\n      removeItem,\n      createOrder\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 62,\n    columnNumber: 5\n  }, this);\n}\n_s(OrderProvider, \"Zp08IPJv970DlA5E/AtWYHyA5Zw=\", false, function () {\n  return [useNavigate, useAuth];\n});\n_c = OrderProvider;\nexport const useOrder = () => {\n  _s2();\n  return useContext(OrderContext);\n};\n_s2(useOrder, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\nvar _c;\n$RefreshReg$(_c, \"OrderProvider\");","map":{"version":3,"names":["createContext","useContext","useState","orderAPI","useNavigate","useAuth","jsxDEV","_jsxDEV","OrderContext","OrderProvider","children","_s","selectedTable","setSelectedTable","orderItems","setOrderItems","navigate","user","addItem","product","prev","existing","find","i","id","map","qty","removeItem","filter","createOrder","length","alert","orderData","table","items","item","productId","productName","name","quantity","price","totalPrice","reduce","sum","create","err","_err$response","_err$response$data","console","error","response","data","message","Provider","value","fileName","_jsxFileName","lineNumber","columnNumber","_c","useOrder","_s2","$RefreshReg$"],"sources":["D:/Baitap/Web2/Endgame_Project/frontend/src/context/OrderContext.jsx"],"sourcesContent":["import { createContext, useContext, useState } from 'react';\r\nimport { orderAPI } from '../services/api';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { useAuth } from './AuthContext'; // ← ĐÚNG ĐẶNG\r\n\r\nconst OrderContext = createContext();\r\n\r\nexport function OrderProvider({ children }) {\r\n  const [selectedTable, setSelectedTable] = useState(null);\r\n  const [orderItems, setOrderItems] = useState([]);\r\n  const navigate = useNavigate();\r\n  const { user } = useAuth(); // ← GỌI useAuth Ở CẤP CAO NHẤT → HỢP LỆ\r\n\r\n  const addItem = (product) => {\r\n    setOrderItems(prev => {\r\n      const existing = prev.find(i => i.id === product.id);\r\n      if (existing) {\r\n        return prev.map(i => i.id === product.id ? { ...i, qty: i.qty + 1 } : i);\r\n      }\r\n      return [...prev, { ...product, qty: 1 }];\r\n    });\r\n  };\r\n\r\n  const removeItem = (id) => {\r\n    setOrderItems(prev => prev.filter(i => i.id !== id));\r\n  };\r\n\r\n  const createOrder = async () => {\r\n    if (!selectedTable || orderItems.length === 0) return;\r\n\r\n    if (!user?.id) {\r\n      alert('Không tìm thấy thông tin người dùng! Vui lòng đăng nhập lại.');\r\n      navigate('/login');\r\n      return;\r\n    }\r\n\r\n    const orderData = {\r\n      user: { id: user.id }, // ← GỬI user.id\r\n      table: { id: selectedTable.id },\r\n      items: orderItems.map(item => ({\r\n        productId: item.id,\r\n        productName: item.name,\r\n        quantity: item.qty,\r\n        price: item.price\r\n      })),\r\n      totalPrice: orderItems.reduce((sum, i) => sum + i.price * i.qty, 0)\r\n    };\r\n\r\n    try {\r\n      await orderAPI.create(orderData);\r\n      alert('Đặt món thành công!');\r\n      setOrderItems([]);\r\n      setSelectedTable(null);\r\n      navigate('/order-success');\r\n    } catch (err) {\r\n      console.error(err);\r\n      alert('Lỗi: ' + (err.response?.data?.message || 'Không thể đặt món'));\r\n    }\r\n  };\r\n\r\n  return (\r\n    <OrderContext.Provider value={{\r\n      selectedTable, setSelectedTable,\r\n      orderItems, addItem, removeItem, createOrder\r\n    }}>\r\n      {children}\r\n    </OrderContext.Provider>\r\n  );\r\n}\r\n\r\nexport const useOrder = () => useContext(OrderContext);"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}